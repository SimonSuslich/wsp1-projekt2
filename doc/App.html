<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: App
  
    &mdash; Documentation by YARD 0.9.37
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "App";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (A)</a> &raquo;
    
    
    <span class="title">App</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: App
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Sinatra::Base</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Sinatra::Base</li>
          
            <li class="next">App</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This is the main application class handling routes for users, admins, products, and the shopping cart. It also includes session management and authentication.</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#db-instance_method" title="#db (instance method)">#<strong>db</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><dl class="rdoc-list label-list"><dt>SQLite3::Database
<dd>
<p>Returns the database connection.</p>
</dd></dl>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#GET-instance_method" title="#GET (instance method)">#<strong>GET</strong>(/cart)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Renders the user’s shopping cart.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#GET____-instance_route" title="#GET &#39;/&#39; (instance route)">#<strong>GET &#39;/&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Redirects the root URL (“/”) to the products page.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#GET___about_-instance_route" title="#GET &#39;/about&#39; (instance route)">#<strong>GET &#39;/about&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Renders the “About” page.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#GET___admin_dashboard_-instance_route" title="#GET &#39;/admin/dashboard&#39; (instance route)">#<strong>GET &#39;/admin/dashboard&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Renders the admin dashboard page.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#GET___admin_log_in_-instance_route" title="#GET &#39;/admin/log_in&#39; (instance route)">#<strong>GET &#39;/admin/log_in&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Displays the admin login page.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#GET___admin_products_-instance_route" title="#GET &#39;/admin/products&#39; (instance route)">#<strong>GET &#39;/admin/products&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Renders the product listing page for the admin panel.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#GET___cart_-instance_route" title="#GET &#39;/cart&#39; (instance route)">#<strong>GET &#39;/cart&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Renders the user’s shopping cart.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#GET___log_in_-instance_route" title="#GET &#39;/log_in&#39; (instance route)">#<strong>GET &#39;/log_in&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Renders the login page for users.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#GET___log_out_-instance_route" title="#GET &#39;/log_out&#39; (instance route)">#<strong>GET &#39;/log_out&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Logs out the current user and destroys the session.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#GET___products_-instance_route" title="#GET &#39;/products&#39; (instance route)">#<strong>GET &#39;/products&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Renders the product listing page for regular users.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#GET___products__product_id_-instance_route" title="#GET &#39;/products/:product_id&#39; (instance route)">#<strong>GET &#39;/products/:product_id&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Displays a single product based on its ID.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#GET___products_new_-instance_route" title="#GET &#39;/products/new&#39; (instance route)">#<strong>GET &#39;/products/new&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Renders the product creation page.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#GET___sign_up_-instance_route" title="#GET &#39;/sign_up&#39; (instance route)">#<strong>GET &#39;/sign_up&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Renders the sign-up page for users.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#GET__error-instance_route" title="#GET /error (instance route)">#<strong>GET /error</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Renders the error page.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#GET__products__id_edit-instance_route" title="#GET /products/:id/edit (instance route)">#<strong>GET /products/:id/edit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Renders the product editing page.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#POST-instance_method" title="#POST (instance method)">#<strong>POST</strong>(/cart/: product_id/delete)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Removes a product from the user’s cart.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#POST___admin_log_in_-instance_route" title="#POST &#39;/admin/log_in&#39; (instance route)">#<strong>POST &#39;/admin/log_in&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#POST___cart__product_id_delete_-instance_route" title="#POST &#39;/cart/:product_id/delete&#39; (instance route)">#<strong>POST &#39;/cart/:product_id/delete&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Removes a product from the user’s cart.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#POST___cart__product_id_new_-instance_route" title="#POST &#39;/cart/:product_id/new&#39; (instance route)">#<strong>POST &#39;/cart/:product_id/new&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Adds a product to the user’s cart.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#POST___log_in_-instance_route" title="#POST &#39;/log_in&#39; (instance route)">#<strong>POST &#39;/log_in&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Logs in a user and starts a session.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#POST___products_-instance_route" title="#POST &#39;/products&#39; (instance route)">#<strong>POST &#39;/products&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates a new product based on the provided parameters.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#POST___sign_up_-instance_route" title="#POST &#39;/sign_up&#39; (instance route)">#<strong>POST &#39;/sign_up&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates a new user and starts a session.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#POST__products__id_update-instance_route" title="#POST /products/:id/update (instance route)">#<strong>POST /products/:id/update</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Updates a product with the new parameters.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#POST__products__product_id_delete-instance_route" title="#POST /products/:product_id/delete (instance route)">#<strong>POST /products/:product_id/delete</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Deletes a product from the database and removes its associated images.</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="db-instance_method">
  
    #<strong>db</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns [SQLite3::Database] Returns the database connection.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>SQLite3::Database
<dd>
<p>Returns the database connection.</p>
</dd></dl>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


18
19
20
21
22
23
24
25</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 18</span>

<span class='kw'>def</span> <span class='id identifier rubyid_db'>db</span>
    <span class='kw'>return</span> <span class='ivar'>@db</span> <span class='kw'>if</span> <span class='ivar'>@db</span>

    <span class='ivar'>@db</span> <span class='op'>=</span> <span class='const'>SQLite3</span><span class='op'>::</span><span class='const'>Database</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>db/vcars.sqlite</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='ivar'>@db</span><span class='period'>.</span><span class='id identifier rubyid_results_as_hash'>results_as_hash</span> <span class='op'>=</span> <span class='kw'>true</span>

    <span class='kw'>return</span> <span class='ivar'>@db</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET-instance_method">
  
    #<strong>GET</strong>(/cart)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Renders the user’s shopping cart.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>GET /cart</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


39
40
41</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 39</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_redirect'>redirect</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/products</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET____-instance_route">
  
    #<strong>GET &#39;/&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Redirects the root URL (“/”) to the products page.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>GET /</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


39
40
41</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 39</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_redirect'>redirect</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/products</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___about_-instance_route">
  
    #<strong>GET &#39;/about&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Renders the “About” page.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>GET /about</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


49
50
51</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 49</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/about</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> 
    <span class='id identifier rubyid_erb'>erb</span><span class='lparen'>(</span><span class='symbol'>:&quot;about&quot;</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___admin_dashboard_-instance_route">
  
    #<strong>GET &#39;/admin/dashboard&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Renders the admin dashboard page.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>GET /admin/dashboard</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


126
127
128</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 126</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/admin/dashboard</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_erb'>erb</span><span class='lparen'>(</span><span class='symbol'>:&quot;admin/dashboard&quot;</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___admin_log_in_-instance_route">
  
    #<strong>GET &#39;/admin/log_in&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Displays the admin login page.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>GET /admin/log_in</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 67</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/admin/log_in</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> 
    <span class='id identifier rubyid_erb'>erb</span><span class='lparen'>(</span><span class='symbol'>:&quot;admin/log_in&quot;</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___admin_products_-instance_route">
  
    #<strong>GET &#39;/admin/products&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Renders the product listing page for the admin panel.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>GET /admin/products</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


136
137
138
139
140
141
142
143
144</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 136</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/admin/products</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> 
    <span class='ivar'>@all_products</span> <span class='op'>=</span> <span class='id identifier rubyid_admin_view_products'>admin_view_products</span><span class='lparen'>(</span><span class='rparen'>)</span>

    <span class='ivar'>@all_products</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_product'>product</span><span class='op'>|</span>
        <span class='id identifier rubyid_product'>product</span><span class='lbracket'>[</span><span class='symbol'>:formated_price</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_pretty_print_price'>pretty_print_price</span><span class='lparen'>(</span><span class='id identifier rubyid_product'>product</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>price</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_erb'>erb</span><span class='lparen'>(</span><span class='symbol'>:&quot;admin/products&quot;</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___cart_-instance_route">
  
    #<strong>GET &#39;/cart&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Renders the user’s shopping cart.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>GET /cart</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 438</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/cart</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> 
    <span class='id identifier rubyid_user_id'>user_id</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span>

    <span class='ivar'>@cart</span> <span class='op'>=</span> <span class='id identifier rubyid_get_cart_by_user'>get_cart_by_user</span><span class='lparen'>(</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>

    <span class='ivar'>@total_cost</span> <span class='op'>=</span> <span class='int'>0</span>
    
    <span class='ivar'>@cart</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_product'>product</span><span class='op'>|</span>
        <span class='id identifier rubyid_product'>product</span><span class='lbracket'>[</span><span class='symbol'>:formated_price</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_pretty_print_price'>pretty_print_price</span><span class='lparen'>(</span><span class='id identifier rubyid_product'>product</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>price</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='ivar'>@total_cost</span> <span class='op'>+=</span> <span class='id identifier rubyid_product'>product</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>price</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='ivar'>@total_cost_formated</span> <span class='op'>=</span> <span class='id identifier rubyid_pretty_print_price'>pretty_print_price</span><span class='lparen'>(</span><span class='ivar'>@total_cost</span><span class='rparen'>)</span>
    
    <span class='id identifier rubyid_erb'>erb</span><span class='lparen'>(</span><span class='symbol'>:&quot;cart&quot;</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___log_in_-instance_route">
  
    #<strong>GET &#39;/log_in&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Renders the login page for users.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>GET /log_in</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


310
311
312</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 310</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/log_in</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_erb'>erb</span><span class='lparen'>(</span><span class='symbol'>:&quot;log_in&quot;</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___log_out_-instance_route">
  
    #<strong>GET &#39;/log_out&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Logs out the current user and destroys the session.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>GET /log_out</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


421
422
423
424</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 421</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/log_out</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> 
    <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
    <span class='id identifier rubyid_redirect'>redirect</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___products_-instance_route">
  
    #<strong>GET &#39;/products&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Renders the product listing page for regular users.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>GET /products</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


152
153
154
155
156
157
158
159
160
161</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 152</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/products</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='ivar'>@all_products</span> <span class='op'>=</span> <span class='id identifier rubyid_select_products_and_combine_images'>select_products_and_combine_images</span><span class='lparen'>(</span><span class='rparen'>)</span>

    <span class='ivar'>@all_products</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_product'>product</span><span class='op'>|</span>
        <span class='id identifier rubyid_format_product_info'>format_product_info</span><span class='lparen'>(</span><span class='id identifier rubyid_product'>product</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_product'>product</span><span class='lbracket'>[</span><span class='symbol'>:formated_price</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_pretty_print_price'>pretty_print_price</span><span class='lparen'>(</span><span class='id identifier rubyid_product'>product</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>price</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_erb'>erb</span><span class='lparen'>(</span><span class='symbol'>:&quot;product/products&quot;</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___products__product_id_-instance_route">
  
    #<strong>GET &#39;/products/:product_id&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Displays a single product based on its ID.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>GET /products/:product_id</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


170
171
172
173
174
175
176</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 170</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/products/:product_id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_product_id'>product_id</span><span class='op'>|</span>
    <span class='ivar'>@product</span> <span class='op'>=</span> <span class='id identifier rubyid_select_products_and_combine_images'>select_products_and_combine_images</span><span class='lparen'>(</span><span class='id identifier rubyid_product_id'>product_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='ivar'>@product</span><span class='lbracket'>[</span><span class='symbol'>:formated_price</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_pretty_print_price'>pretty_print_price</span><span class='lparen'>(</span><span class='ivar'>@product</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>price</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_format_product_info'>format_product_info</span><span class='lparen'>(</span><span class='ivar'>@product</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_erb'>erb</span><span class='lparen'>(</span><span class='symbol'>:&quot;product/show&quot;</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___products_new_-instance_route">
  
    #<strong>GET &#39;/products/new&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Renders the product creation page.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>GET /products/new</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


184
185
186</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 184</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/products/new</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> 
    <span class='id identifier rubyid_erb'>erb</span><span class='lparen'>(</span><span class='symbol'>:&quot;product/new&quot;</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET___sign_up_-instance_route">
  
    #<strong>GET &#39;/sign_up&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Renders the sign-up page for users.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>GET /sign_up</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


364
365
366</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 364</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/sign_up</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_erb'>erb</span><span class='lparen'>(</span><span class='symbol'>:&quot;sign_up&quot;</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET__error-instance_route">
  
    #<strong>GET /error</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Renders the error page.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>GET /error</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


300
301
302</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 300</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/error</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> 
    <span class='id identifier rubyid_erb'>erb</span><span class='lparen'>(</span><span class='symbol'>:&quot;error&quot;</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET__products__id_edit-instance_route">
  
    #<strong>GET /products/:id/edit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Renders the product editing page.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>GET /products/:id/edit</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


250
251
252
253
254
255
256</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 250</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/products/:id/edit</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
    <span class='id identifier rubyid_authenticate_admin'>authenticate_admin</span><span class='lparen'>(</span><span class='rparen'>)</span>

    <span class='ivar'>@product</span> <span class='op'>=</span> <span class='id identifier rubyid_select_products_and_combine_images'>select_products_and_combine_images</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>

    <span class='id identifier rubyid_erb'>erb</span><span class='lparen'>(</span><span class='symbol'>:&quot;product/edit&quot;</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST-instance_method">
  
    #<strong>POST</strong>(/cart/: product_id/delete)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Removes a product from the user’s cart.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>product_id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The ID of the product to remove.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>POST /cart/:product_id/delete</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 197</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/products</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> 
    <span class='id identifier rubyid_authenticate_admin'>authenticate_admin</span><span class='lparen'>(</span><span class='rparen'>)</span>

    <span class='comment'># Access form fields
</span>    <span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>title</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_price'>price</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>price</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_product_type'>product_type</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>product_type</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_model_year'>model_year</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>model_year</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_gear_box'>gear_box</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>gear_box</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_brand'>brand</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>brand</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_fuel'>fuel</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>fuel</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_horse_power'>horse_power</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>horse_power</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_milage_km'>milage_km</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>milage_km</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_exterior_color'>exterior_color</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>exterior_color</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_condition'>condition</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>condition</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_description'>description</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>description</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

    <span class='comment'># Insert product into the database
</span>    <span class='id identifier rubyid_new_product'>new_product</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='id identifier rubyid_description'>description</span><span class='comma'>,</span> <span class='id identifier rubyid_price'>price</span><span class='comma'>,</span> <span class='id identifier rubyid_model_year'>model_year</span><span class='comma'>,</span> <span class='id identifier rubyid_gear_box'>gear_box</span><span class='comma'>,</span> <span class='id identifier rubyid_brand'>brand</span><span class='comma'>,</span> <span class='id identifier rubyid_fuel'>fuel</span><span class='comma'>,</span> <span class='id identifier rubyid_horse_power'>horse_power</span><span class='comma'>,</span> <span class='id identifier rubyid_milage_km'>milage_km</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_color'>exterior_color</span><span class='comma'>,</span> <span class='id identifier rubyid_product_type'>product_type</span><span class='comma'>,</span> <span class='id identifier rubyid_condition'>condition</span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='comment'># Get the product ID for the uploaded images
</span>    <span class='id identifier rubyid_product_id'>product_id</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_last_insert_row_id'>last_insert_row_id</span>

    <span class='comment'># Store images for the product
</span>    <span class='id identifier rubyid_store_new_product_images'>store_new_product_images</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>new_images</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_product_id'>product_id</span><span class='rparen'>)</span>

    <span class='comment'># Redirect back to the admin page
</span>    <span class='id identifier rubyid_redirect'>redirect</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/products/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_product_id'>product_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___admin_log_in_-instance_route">
  
    #<strong>POST &#39;/admin/log_in&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 84</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/admin/log_in</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_ip'>ip</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_ip'>ip</span>
    <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbrace'>{</span> <span class='label'>count:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>last_attempt:</span> <span class='kw'>nil</span> <span class='rbrace'>}</span>

    <span class='comment'># Reset failed attempts after 24 hours
</span>    <span class='kw'>if</span> <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:last_attempt</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:last_attempt</span><span class='rbracket'>]</span> <span class='op'>&gt;</span> <span class='int'>24</span><span class='op'>*</span><span class='int'>3600</span>
        <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>count:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>last_attempt:</span> <span class='kw'>nil</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>

    <span class='comment'># Enforce rate limit for login attempts (max 3 within 1 minute)
</span>    <span class='kw'>if</span> <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:count</span><span class='rbracket'>]</span> <span class='op'>&gt;=</span> <span class='int'>3</span>
        <span class='kw'>if</span> <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:last_attempt</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:last_attempt</span><span class='rbracket'>]</span> <span class='op'>&lt;</span> <span class='int'>60</span>
            <span class='id identifier rubyid_halt'>halt</span> <span class='id identifier rubyid_erb'>erb</span><span class='lparen'>(</span><span class='symbol'>:error</span><span class='comma'>,</span> <span class='label'>locals:</span> <span class='lbrace'>{</span> <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Too many attempts. Try again later.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>status:</span> <span class='int'>429</span><span class='comma'>,</span> <span class='label'>route:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/admin/log_in</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_admin_name_email'>admin_name_email</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name_email</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_cleartext_password'>cleartext_password</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>password</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> 

    <span class='id identifier rubyid_admin'>admin</span> <span class='op'>=</span> <span class='id identifier rubyid_get_admin'>get_admin</span><span class='lparen'>(</span><span class='id identifier rubyid_admin_name_email'>admin_name_email</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_password_from_db'>password_from_db</span> <span class='op'>=</span> <span class='const'>BCrypt</span><span class='op'>::</span><span class='const'>Password</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_admin'>admin</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>password</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='comment'># Check if password matches
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_password_from_db'>password_from_db</span> <span class='op'>==</span> <span class='id identifier rubyid_cleartext_password'>cleartext_password</span>
        <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:admin_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_admin'>admin</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
        <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>count:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>last_attempt:</span> <span class='kw'>nil</span> <span class='rbrace'>}</span>
        <span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/admin/dashboard</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>else</span>
        <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:count</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_p'>p</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>count increased</span><span class='tstring_end'>&quot;</span></span>
        <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:last_attempt</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
        <span class='id identifier rubyid_halt'>halt</span> <span class='id identifier rubyid_erb'>erb</span><span class='lparen'>(</span><span class='symbol'>:error</span><span class='comma'>,</span> <span class='label'>locals:</span> <span class='lbrace'>{</span> <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid credentials</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>status:</span> <span class='int'>401</span><span class='comma'>,</span> <span class='label'>route:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/admin/log_in</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___cart__product_id_delete_-instance_route">
  
    #<strong>POST &#39;/cart/:product_id/delete&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Removes a product from the user’s cart.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>POST /cart/:product_id/delete</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


479
480
481
482</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 479</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/cart/:product_id/delete</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_product_id'>product_id</span><span class='op'>|</span>
    <span class='id identifier rubyid_remove_product_from_cart'>remove_product_from_cart</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_product_id'>product_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_redirect'>redirect</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/cart</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___cart__product_id_new_-instance_route">
  
    #<strong>POST &#39;/cart/:product_id/new&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Adds a product to the user’s cart.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>POST /cart/:product_id/new</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


462
463
464
465
466
467
468
469
470</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 462</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/cart/:product_id/new</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_product_id'>product_id</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_product_in_cart?'>product_in_cart?</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_product_id'>product_id</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_redirect'>redirect</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/cart</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='id identifier rubyid_new_product_in_cart'>new_product_in_cart</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_product_id'>product_id</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_redirect'>redirect</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/products/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_product_id'>product_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___log_in_-instance_route">
  
    #<strong>POST &#39;/log_in&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Logs in a user and starts a session.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Successful login</p>
</div></h5>
      
      <pre class="example code"><code>POST /log_in</code></pre>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Failed login (invalid credentials)</p>
</div></h5>
      
      <pre class="example code"><code>POST /log_in -&gt; 401 Invalid credentials</code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>POST /log_in</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 326</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/log_in</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_ip'>ip</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_ip'>ip</span>
    <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbrace'>{</span> <span class='label'>count:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>last_attempt:</span> <span class='kw'>nil</span> <span class='rbrace'>}</span>

    <span class='comment'># Reset failed attempts after 24 hours
</span>    <span class='kw'>if</span> <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:last_attempt</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:last_attempt</span><span class='rbracket'>]</span> <span class='op'>&gt;</span> <span class='int'>3600</span><span class='op'>*</span><span class='int'>24</span>
        <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>count:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>last_attempt:</span> <span class='kw'>nil</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>

    <span class='comment'># Enforce rate limit for login attempts (max 1 attempt within 1 minute)
</span>    <span class='kw'>if</span> <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:count</span><span class='rbracket'>]</span> <span class='op'>&gt;=</span> <span class='int'>1</span> <span class='op'>&amp;&amp;</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:last_attempt</span><span class='rbracket'>]</span> <span class='op'>&lt;</span> <span class='int'>60</span>
        <span class='id identifier rubyid_halt'>halt</span> <span class='id identifier rubyid_erb'>erb</span><span class='lparen'>(</span><span class='symbol'>:error</span><span class='comma'>,</span> <span class='label'>locals:</span> <span class='lbrace'>{</span> <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Too many attempts. Try again later.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>status:</span> <span class='int'>429</span><span class='comma'>,</span> <span class='label'>route:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/log_in</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_user_name_email'>user_name_email</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_name_email</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_cleartext_password'>cleartext_password</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>password</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> 

    <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='id identifier rubyid_get_user'>get_user</span><span class='lparen'>(</span><span class='id identifier rubyid_user_name_email'>user_name_email</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_password_from_db'>password_from_db</span> <span class='op'>=</span> <span class='const'>BCrypt</span><span class='op'>::</span><span class='const'>Password</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>password</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='comment'># Check if password matches
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_password_from_db'>password_from_db</span> <span class='op'>==</span> <span class='id identifier rubyid_cleartext_password'>cleartext_password</span> 
        <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>else</span>
        <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:count</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:last_attempt</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
        <span class='id identifier rubyid_halt'>halt</span> <span class='id identifier rubyid_erb'>erb</span><span class='lparen'>(</span><span class='symbol'>:error</span><span class='comma'>,</span> <span class='label'>locals:</span> <span class='lbrace'>{</span> <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid credentials</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>status:</span> <span class='int'>401</span><span class='comma'>,</span> <span class='label'>route:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/log_in</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___products_-instance_route">
  
    #<strong>POST &#39;/products&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Creates a new product based on the provided parameters.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Successful product creation</p>
</div></h5>
      
      <pre class="example code"><code>POST /products</code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>POST /products</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 197</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/products</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> 
    <span class='id identifier rubyid_authenticate_admin'>authenticate_admin</span><span class='lparen'>(</span><span class='rparen'>)</span>

    <span class='comment'># Access form fields
</span>    <span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>title</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_price'>price</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>price</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_product_type'>product_type</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>product_type</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_model_year'>model_year</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>model_year</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_gear_box'>gear_box</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>gear_box</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_brand'>brand</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>brand</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_fuel'>fuel</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>fuel</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_horse_power'>horse_power</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>horse_power</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_milage_km'>milage_km</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>milage_km</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_exterior_color'>exterior_color</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>exterior_color</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_condition'>condition</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>condition</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_description'>description</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>description</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

    <span class='comment'># Insert product into the database
</span>    <span class='id identifier rubyid_new_product'>new_product</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='id identifier rubyid_description'>description</span><span class='comma'>,</span> <span class='id identifier rubyid_price'>price</span><span class='comma'>,</span> <span class='id identifier rubyid_model_year'>model_year</span><span class='comma'>,</span> <span class='id identifier rubyid_gear_box'>gear_box</span><span class='comma'>,</span> <span class='id identifier rubyid_brand'>brand</span><span class='comma'>,</span> <span class='id identifier rubyid_fuel'>fuel</span><span class='comma'>,</span> <span class='id identifier rubyid_horse_power'>horse_power</span><span class='comma'>,</span> <span class='id identifier rubyid_milage_km'>milage_km</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_color'>exterior_color</span><span class='comma'>,</span> <span class='id identifier rubyid_product_type'>product_type</span><span class='comma'>,</span> <span class='id identifier rubyid_condition'>condition</span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='comment'># Get the product ID for the uploaded images
</span>    <span class='id identifier rubyid_product_id'>product_id</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_last_insert_row_id'>last_insert_row_id</span>

    <span class='comment'># Store images for the product
</span>    <span class='id identifier rubyid_store_new_product_images'>store_new_product_images</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>new_images</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_product_id'>product_id</span><span class='rparen'>)</span>

    <span class='comment'># Redirect back to the admin page
</span>    <span class='id identifier rubyid_redirect'>redirect</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/products/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_product_id'>product_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___sign_up_-instance_route">
  
    #<strong>POST &#39;/sign_up&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Creates a new user and starts a session.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Successful sign-up</p>
</div></h5>
      
      <pre class="example code"><code>POST /sign_up</code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>POST /sign_up</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 377</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/sign_up</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> 
    <span class='id identifier rubyid_ip'>ip</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_ip'>ip</span>
    <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbrace'>{</span> <span class='label'>count:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>last_attempt:</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='rbrace'>}</span>

    <span class='comment'># Reset failed attempts after 24 hours
</span>    <span class='kw'>if</span> <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:last_attempt</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:last_attempt</span><span class='rbracket'>]</span> <span class='op'>&gt;</span> <span class='int'>3600</span> <span class='op'>*</span> <span class='int'>24</span>
        <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>count:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>last_attempt:</span> <span class='kw'>nil</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>

    <span class='comment'># Enforce rate limit for sign-up attempts (max 3 within 1 minute)
</span>    <span class='kw'>if</span> <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:count</span><span class='rbracket'>]</span> <span class='op'>&gt;=</span> <span class='int'>3</span> <span class='op'>&amp;&amp;</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:last_attempt</span><span class='rbracket'>]</span> <span class='op'>&lt;</span> <span class='int'>60</span>
        <span class='id identifier rubyid_halt'>halt</span> <span class='id identifier rubyid_erb'>erb</span><span class='lparen'>(</span><span class='symbol'>:error</span><span class='comma'>,</span> <span class='label'>locals:</span> <span class='lbrace'>{</span> <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Too many attempts. Try again later.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>status:</span> <span class='int'>429</span><span class='comma'>,</span> <span class='label'>route:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/sign_up</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_username'>username</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>username</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_user_email'>user_email</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_email</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_password'>password</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>password</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_confirm_password'>confirm_password</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>confirm_password</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

    <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:count</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='const'>FAILED_ATTEMPTS</span><span class='lbracket'>[</span><span class='id identifier rubyid_ip'>ip</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:last_attempt</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>

    <span class='id identifier rubyid_check_username_and_email'>check_username_and_email</span><span class='lparen'>(</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_user_email'>user_email</span><span class='rparen'>)</span>

    <span class='comment'># Validate that passwords match
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_password'>password</span> <span class='op'>!=</span> <span class='id identifier rubyid_confirm_password'>confirm_password</span>
        <span class='id identifier rubyid_halt'>halt</span> <span class='id identifier rubyid_erb'>erb</span><span class='lparen'>(</span><span class='symbol'>:error</span><span class='comma'>,</span> <span class='label'>locals:</span> <span class='lbrace'>{</span> <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Passwords do not match</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>status:</span> <span class='int'>400</span><span class='comma'>,</span> <span class='label'>route:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/sign_up</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_hashed_password'>hashed_password</span> <span class='op'>=</span> <span class='const'>BCrypt</span><span class='op'>::</span><span class='const'>Password</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='id identifier rubyid_password'>password</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_new_user'>new_user</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_user_email'>user_email</span><span class='comma'>,</span> <span class='id identifier rubyid_hashed_password'>hashed_password</span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_user_id'>user_id</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_last_insert_row_id'>last_insert_row_id</span>
    <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_user_id'>user_id</span>

    <span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST__products__id_update-instance_route">
  
    #<strong>POST /products/:id/update</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Updates a product with the new parameters.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>POST /products/:id/update</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 265</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/products/:id/update</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
    <span class='id identifier rubyid_authenticate_admin'>authenticate_admin</span><span class='lparen'>(</span><span class='rparen'>)</span>

    <span class='comment'># Access form fields
</span>    <span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>title</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_price'>price</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>price</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_product_type'>product_type</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>product_type</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_model_year'>model_year</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>model_year</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_gear_box'>gear_box</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>gear_box</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_brand'>brand</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>brand</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_fuel'>fuel</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>fuel</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_horse_power'>horse_power</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>horse_power</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_milage_km'>milage_km</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>milage_km</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_exterior_color'>exterior_color</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>exterior_color</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_condition'>condition</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>condition</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_description'>description</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>description</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

    <span class='comment'># Update product in the database
</span>    <span class='id identifier rubyid_update_product'>update_product</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='id identifier rubyid_description'>description</span><span class='comma'>,</span> <span class='id identifier rubyid_price'>price</span><span class='comma'>,</span> <span class='id identifier rubyid_model_year'>model_year</span><span class='comma'>,</span> <span class='id identifier rubyid_gear_box'>gear_box</span><span class='comma'>,</span> <span class='id identifier rubyid_brand'>brand</span><span class='comma'>,</span> <span class='id identifier rubyid_fuel'>fuel</span><span class='comma'>,</span> <span class='id identifier rubyid_horse_power'>horse_power</span><span class='comma'>,</span> <span class='id identifier rubyid_milage_km'>milage_km</span><span class='comma'>,</span> <span class='id identifier rubyid_exterior_color'>exterior_color</span><span class='comma'>,</span> <span class='id identifier rubyid_product_type'>product_type</span><span class='comma'>,</span> <span class='id identifier rubyid_condition'>condition</span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='comment'># Store new product images if provided
</span>    <span class='id identifier rubyid_store_new_product_images'>store_new_product_images</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>new_images</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>new_images</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

    <span class='comment'># Sort images and remove old ones if necessary
</span>    <span class='id identifier rubyid_sort_images_and_remove_rest'>sort_images_and_remove_rest</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:images_order</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>,</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:images_order</span><span class='rbracket'>]</span>

    <span class='id identifier rubyid_redirect'>redirect</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/products/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST__products__product_id_delete-instance_route">
  
    #<strong>POST /products/:product_id/delete</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Deletes a product from the database and removes its associated images.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
      
      
        
        <div class='inline'><dl class="rdoc-list label-list"><dt>void
<dd></dd></dl>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Route:</p>
<ul class="route">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>POST /products/:product_id/delete</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


234
235
236
237
238
239
240
241</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 234</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/products/:product_id/delete</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_product_id'>product_id</span><span class='op'>|</span>
    <span class='id identifier rubyid_authenticate_admin'>authenticate_admin</span><span class='lparen'>(</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_delete_product'>delete_product</span><span class='lparen'>(</span><span class='id identifier rubyid_product_id'>product_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_remove_product_image_folder'>remove_product_image_folder</span><span class='lparen'>(</span><span class='id identifier rubyid_product_id'>product_id</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_redirect'>redirect</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/admin/products</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sat Mar 15 16:01:42 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.2.2).
</div>

    </div>
  </body>
</html>